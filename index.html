<!DOCTYPE html>
<html manifest="manifest">
	<head>
		<style type="text/css">
body {
    margin: 0;
	overflow: hidden;
}
#new {
	display: none;
}
		</style>
		<title>Colors</title>
	</head>
	<body>
		<img id="new" src="data:image/png;base64,
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">
		<div id="canvas">
			<canvas>
			</canvas>
		</div>
		<script>
(function () {
	'use strict';
	var qs = function (q) {return document.querySelector(q);},
		ctx = qs('canvas').getContext('2d'),
		wait = 500,
		drawSquare,
		drawBoard,
		newGame,
		blink,
		ignore = function (q) {console.log('ignored (' + q + ')');},
		click,
		play,
		record,
		start,
		colors = ['yellow', 'red', 'rgb(0,255,0)', 'blue'],
		list = [],
		xside,
		yside,
		fsize,
		stop = true;

		drawSquare = function (q, color) {
			var x = 0,
				y = 0;
			ctx.save()
			ctx.fillStyle = color;
			if (q === 1) {
				x = xside;
			}
			else if (q === 2) {
				y = yside;
			}
			else if (q === 3) {
				x = xside;
				y = yside;
			}
			ctx.fillRect(x, y, xside, yside);
			ctx.restore();
		};

		drawBoard = function () {
			var q;
			for (q = 0; q < 4; q++) {
				drawSquare(q, colors[q]);
			}
		};

		newGame = function () {
			var img = qs('#new'),
				x,
				y;
			stop = true;
			xside = Math.floor(window.innerWidth / 2);
			yside = Math.floor(window.innerHeight / 2);
			fsize = xside;
			if (yside < fsize) {
				fsize = yside;
			}
			qs('canvas').width = 2 * xside;
			qs('canvas').height = 2 * yside;

			x = Math.floor((2 * xside - img.width) / 2),
			y = Math.floor((2 * yside - img.height) / 2);
			drawBoard();
			ctx.save()
			ctx.drawImage(img, x, y);
			ctx.restore()
			click = start;
		};

		blink = function (q, cont, timeout) {
			if (typeof timeout === 'undefined' || timeout < 0) {
				timeout = 2 * wait;
			}
			if (cont) {
				setTimeout(cont, timeout);
			}
			if (stop) {
				return;
			}
			drawSquare(q, 'rgba(0, 0, 0, 0.5)');
			setTimeout(function () {
				if (stop) {
					return;
				}
				drawSquare(q, colors[q]);
			}, wait);
		};

		play = function () {
			var i = -1,
				repeat;
			stop = false;
			list.push(Math.floor(Math.random() * 4));
			console.log(list);
			repeat = function () {
				i++;
				if (i < list.length) {
					blink(list[i], repeat, i === list.length - 1 ? 0 : -1);
				}
				else {
					record();
				}
			};
			repeat();
		};

		record = function () {
			var guess = [];
			click = function (q) {
				guess.push(q);
				console.log(guess);
				if (q !== list[guess.length - 1]) {
					click = ignore;
					stop = true;
					ctx.save();
 					ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
					ctx.fillRect(0, 0, 2 * xside, 2 * yside);
					ctx.restore();
					ctx.save();
					ctx.textBaseline = 'middle';
					ctx.textAlign = 'center';
					ctx.font = 'bold ' + fsize + 'px sans-serif';
					ctx.fillText('' + (list.length - 1), xside, yside);
					ctx.restore();
					setTimeout(function () {click = newGame;}, 3 * wait);
					return;
				}
				if (guess.length === list.length) {
					click = ignore;
					blink(q, function () {setTimeout(play, 2 * wait);});
					return;
				}
				blink(q);
			};
		};

		qs('canvas').addEventListener('click', function (e) {
			var q;
			if (e.offsetX < xside) {
				if (e.offsetY < yside) {
					q = 0;
				}
				else {
					q = 2;
				}
			}
			else {
				if (e.offsetY < yside) {
					q = 1;
				}
				else {
					q = 3;
				}
			}
			click(q);
		}, false);

		start = function () {
			var q;
			list = [];
			drawBoard();
			setTimeout(play, wait);
		};

		window.addEventListener('load', newGame, false);
		window.addEventListener('resize', newGame, false);
}());
		</script>
	

</body></html>
