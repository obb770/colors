<!DOCTYPE html>
<html manifest="manifest">
 <head>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style"
    content="black-translucent" />
  <style type="text/css">
body {
    margin: 0;
    overflow: hidden;
}
#new {
    display: none;
}
  </style>
  <title>Colors</title>
 </head>
 <body>
  <img id="new" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAR8AAACnCAMAAAAfZ6jTAAAABGdBTUEAALGPC/xhBQAAAAFzUkdC
AK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAD9QTFRF
AAAA/////7ZmAABmtv////+2ZgAAAAA6kNv//9uQOgAAOpDbZrb/25A6AGa2ADqQ2///tmYA///b
kDoAZmZm1jkeiQAAAAFiS0dEAf8CLd4AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAWPSURBVHja7Z3b
cpwwDIYXtzk0YFK3ff9n7eKjZMvYsLM4k/l109mmYOmzThZsertBIJBnygSRBXzAB3zAB3zAB3zA
B3wg4AM+4AM+4AM+4AM+4AM+4AM+4AM+4AM+4AM+EPABH/ABH/ABH/ABH/CBgA/4gA/4gA/4gA/4
QMAHfMAHfMAHfMAHfApR96t//AQfWV5et6vf3sFHlF8f9uoZ8VWNrbssyD+iaHvpOkBrvzG3z99f
mI8a5TyafHF//rJ8RuHR/DcbzF+UzyA8Ov/ND0+unWf5uMp1NR5fL0PiUc/XoY+PzlOh63uuxmMK
l3l5fXJv2sVH5XXqz98BbY9b9OJd6eHjFKMOZAbgcS57dTvRw0flXq0HKOrxXB3SHXwKv1bXtGYC
nusPwh18VNZp2CJysaZujwa06m0+wX0CH/f5Yj83o04ybT4q61T1gNysRuFp89nc5e19i6k5RdeI
5HPxmr18lPWWTcM5RtfV8zAzbgbX4uPcJ/FRA6LLuuygGVyLj3KeHfhY97m6ypph0dXkY3nMU+Sj
BtQu6z6jZpQNPhuXLfJDfh6xlWRNxWcb3JH1M2pcg48Pr8DHFpKLtzKtGacb0uzH/3C9lo/xmdHz
UYX7HG6mf30crESKj3sq/hPYpZsrAsvsgNu3YJ+Pr16hyltcS3lo7N+27YYH07uJxSt28uV0PrnW
TFWbm9OYlgX7fLZlrRapC6LuE2/eC2i730E8IQOyVnqWysjn7+2Pleq2krGauG7Tgn0+Ouji4ktx
92H7uXSGytE+Lw9pJZliSqeyyq3Et6SF2xbs8onh5fjkwaFvqTnqcSB9pg3W3F2SStMkRBdR0ASl
DIs8i2TptmCXTwyvpMGaabWGZdpV/9wpIUt5qhZdRU0L5T6qPpMcP/dasMsndRQxTheu+Tp18zGn
WsvMX/JsxE/3bIkQiJpmbsUodliwx4e4YuCTVVT/UerM7hczQ87hyQueZEdaKXT7lI+7ge9PeJlr
WNDkQ64PLrxK7sNCepKnaCfx2I1JfEjRZu6zTCWfTfs1BKSrbH5O4n/SsKDNh2xW+WyFzGQ0T4ux
YSJ/q8+e2zgfLdTpu2qsZtEGaLUQ7grZn/zz2Xj7EJKyYEEvH7aayWukim6q87bMq0D87fyEgvER
3ed+70XS2LmMLzEphS8xZisWdPNhh62ixzJyK+tVzNp9c3qAw/KPuM26xs9s/9ik+UPcMH9PU2vG
O/moIkBI+sl6/SXrAW1Vjgdvdf7gSPmIp2MSXpkfGFKrWH1x96xa0MuHzTJU9jIJacwz3zBxQ4I9
PIcc73/CteJw5e6p7MiVdNHEM4I/L6lnqFvQx4cFc/E6i7fdrTtLzewcE7x+ZDxqYpDK7bfOc8DK
VWZN4jplfEQL+vhsFyZ17G2Idul4IzeCcap2m/mNjopm059VWm3hjrtkG7Xk5dTx2bGgiw9vxXI+
O4+knF5WF3M7OP+oPT+pjmk2L1jKhLimFEDajYX5ZNdDtTofHu12MaaeqZqeHnaqx1/y8g1D7XU1
3+W4ZPP2rsgp1ROzSvMGw+c007F5VT7ZkwrhwYUp/5ujdJh1RIS2+9T4uW4IdRuSiK0imuhkaI4J
Ob1qQQef3GGE3qOYB4f9TTVFPf6OYFpFbFF0blo6Najm3lQt6PSfbIJZhD+//1zb/ceG5mo3DHYG
pFm97yA0H6xfC/+81vev6iLm8WcKZe4r8Unrd74kuWvBd/5+k+Xz4HP7b/39L/X4c3t8Pw58wAd8
wAd8wAd8wAcCPuADPuADPuADPuADPuADPuADPuADPuADPuADAR/wAR/wAR/wAR/wAR8I+IAP+IAP
+IAP+IAPBHzAB3zAB3zAB3zAB3wg4AM+4AM+4AM+4AM+4AM+4PMQHwgE8hz5Dyf21Er+Pz/tAAAA
JXRFWHRkYXRlOmNyZWF0ZQAyMDE0LTAxLTAzVDE5OjIyOjEwKzAyOjAw+FKyEgAAACV0RVh0ZGF0
ZTptb2RpZnkAMjAxNC0wMS0wM1QxOToyMjoxMCswMjowMIkPCq4AAAAASUVORK5CYII=">
  <div id="canvas">
   <canvas></canvas>
  </div>
  <script>
/*jshint browser:true */
(function () {
    'use strict';
    var WAIT = 500,
        qs = function (q) {return document.querySelector(q);},
        Quad,
        newGame,
        click,
        later,
        play,
        record,
        ctx = qs('canvas').getContext('2d'),
        game;

        Quad = function (color, x, y) {
            this.color = color;
            this.x = x;
            this.y = y;
        };
        Quad.prototype.draw = function (color) {
            ctx.save();
            ctx.fillStyle = typeof color === 'undefined' ? this.color : color;
            ctx.fillRect(this.x, this.y, game.xside, game.yside);
            ctx.restore();
        };
        Quad.prototype.blink = function (then, timeout) {
            var thiz = this;
            if (typeof timeout === 'undefined' || timeout < 0) {
                timeout = 2 * WAIT;
            }
            if (then) {
                later(then, timeout);
            }
            this.draw('rgba(0, 0, 0, 0.5)');
            later(function () {
                thiz.draw();
            }, WAIT, true);
        };

        later = function (func, when, clearable) {
            var e = setTimeout(func, when);
            if (clearable) {
                game.events.push(e);
            }
        };

        newGame = function () {
            var drawBoard,
                img = qs('#new'),
                x,
                y;

            drawBoard = function () {
                var q;
                for (q = 0; q < 4; q++) {
                    game.quads[q].draw();
                }
            };

            game = {};
            game.events = [];
            game.xside = Math.floor(window.innerWidth / 2);
            game.yside = Math.floor(window.innerHeight / 2);
            game.fsize = game.xside;
            if (game.yside < game.fsize) {
                game.fsize = game.yside;
            }
            qs('canvas').width = 2 * game.xside;
            qs('canvas').height = 2 * game.yside;

            game.quads = [];
            game.quads.push(new Quad('yellow', 0, 0));
            game.quads.push(new Quad('red', game.xside, 0));
            game.quads.push(new Quad('rgb(0, 255, 0)', 0, game.yside));
            game.quads.push(new Quad('blue', game.xside, game.yside));

            x = Math.floor((2 * game.xside - img.width) / 2);
            y = Math.floor((2 * game.yside - img.height) / 2);
            drawBoard();
            ctx.save();
            ctx.drawImage(img, x, y);
            ctx.restore();
            click = function () {
                game.list = [];
                drawBoard();
                later(play, WAIT);
            };
        };

        play = function () {
            var i = -1,
                repeat;
            game.list.push(Math.floor(Math.random() * 4));
            console.log(game.list);
            repeat = function () {
                i++;
                if (i < game.list.length) {
                    game.quads[game.list[i]].blink(repeat,
                        i === game.list.length - 1 ? 0 : -1);
                }
                else {
                    record();
                }
            };
            repeat();
        };

        record = function () {
            var guess = [],
                gameOver;

            gameOver = function () {
                var e;
                while (true) {
                    e = game.events.pop();
                    if (typeof e === 'undefined') {
                        break;
                    }
                    clearTimeout(e);
                }
                ctx.save();
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.fillRect(0, 0, 2 * game.xside, 2 * game.yside);
                ctx.restore();
                ctx.save();
                ctx.textBaseline = 'middle';
                ctx.textAlign = 'center';
                ctx.font = 'bold ' + game.fsize + 'px sans-serif';
                ctx.fillText('' + (game.list.length - 1),
                    game.xside, game.yside);
                ctx.restore();
                later(function () {click = newGame;}, 3 * WAIT);
            };

            click = function (q) {
                var ignore = function (q) {console.log('ignored (' + q + ')');};
                guess.push(q);
                console.log(guess);
                if (q !== game.list[guess.length - 1]) {
                    click = ignore;
                    gameOver();
                    return;
                }
                if (guess.length === game.list.length) {
                    click = ignore;
                    game.quads[q].blink(
                        function () {later(play, 2 * WAIT);});
                    return;
                }
                game.quads[q].blink();
            };
        };

        window.addEventListener('load', function() {
            var mouseDown = function (e) {
                var q = 0;
                if (e.clientY >= game.yside) {
                    q += 2;
                }
                if (e.clientX >= game.xside) {
                    q += 1;
                }
                click(q);
            };

            newGame();
            qs('canvas').addEventListener('mousedown', mouseDown, false);
            qs('canvas').addEventListener('touchstart', function (e) {
                e.preventDefault();
                return mouseDown.call(this, e.changedTouches[0]);
            }, false);
        }, false);
        window.addEventListener('resize', newGame, false);
}());
  </script>
 </body>
</html>
